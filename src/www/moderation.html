<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PocketNet</title>
    <link rel="stylesheet" href="/css/main.css">
</head>

<body>
    <header class="head-box sticky-header">
        <div class="head-box-item head-box-title">‚ãÆ</div>
        <div class="head-box-item head-box-subtitle"><a href="/nodes">Nodes</a></div>
        <div class="head-box-item head-box-title"><a href="/moderation">Moderation</a></div>
    </header>
    
    <main>
        <div class="post-header-box">
            <div id="statistics">
                <div id="stats-text"></div>
            </div>
        </div>
        <table>
            <thead class="sticky-header sticky-header-table">
                <tr>
                    <th>#</th>
                    <th>ID</th>
                    <th>–ê–¥—Ä–µ—Å</th>
                    <th>–í—ã—Å–æ—Ç–∞</th>
                    <th>–ü—Ä–∏—á–∏–Ω–∞</th>
                    <th>–í–µ—Ä–¥–∏–∫—Ç</th>
                </tr>
            </thead>
            <tbody id="jury-list">
                <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –∂—é—Ä–∏ -->
            </tbody>
        </table>
        <div class="pagination" id="pagination">
            <!-- –ö–Ω–æ–ø–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </main>

    <button class="theme-toggle" onclick="toggleTheme()">üåì –¢–µ–º–∞</button>
    
    <footer style="
        margin-top: 20px;
        padding: 20px;
        text-align: center;
        color: var(--text-color);
    ">
        <p>
            ¬© <script>document.write(new Date().getFullYear())</script> PocketNET Team.
            <a href="https://www.apache.org/licenses/LICENSE-2.0" style="color: var(--text-color);">
                Licensed under the Apache License, Version 2.0
            </a>
        </p>
        <p>
            <a href="https://bastyon.com" style="color: var(--text-color); margin-right: 20px;">Bastyon</a>
            <a href="https://bastyon.com/blockexplorer" style="color: var(--text-color);">Block Explorer</a>
        </p>
    </footer>

    <script>
        let juryList = {}; // –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∂—é—Ä–∏ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        let currentPage = 0; // –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ currentPage
        const itemsPerPage = 15;

        const reasonDictionary = {
            '1': '–≠—Ä–æ—Ç–∏–∫–∞/–ü–æ—Ä–Ω–æ',
            '2': '–î–µ—Ç—Å–∫–∞—è —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è',
            '3': '–ü—Ä—è–º–∞—è —É–≥—Ä–æ–∑–∞ –Ω–∞—Å–∏–ª–∏—è',
            '4': '–ù–µ–ª–µ–≥–∞–ª—å–Ω—ã–µ –Ω–∞—Ä–∫–æ—Ç–∏–∫–∏',
            '5': '–ù–∞—Ä—É—à–µ–Ω–∏–µ –∞–≤—Ç—Ä–æ—Å–∫–∏—Ö –ø—Ä–∞–≤',
            '6': '–°–ø–∞–º'
        };

        const verdictDictionary = {
            '-1': '–í –ø—Ä–æ—Ü–µ—Å—Å–µ',
            '0': '–û–ø—Ä–∞–≤–¥–∞–Ω',
            '1': '–û—Å—É–∂–¥–µ–Ω'
        };

        function renderJury() {
            const juryListElement = document.getElementById('jury-list');
            juryListElement.innerHTML = '';

            juryList.items.forEach((jury, index) => {
                const row = document.createElement('tr');
                const reasonText = reasonDictionary[jury.reason] || jury.reason;
                const verdictText = verdictDictionary[jury.verdict] || jury.verdict;
                const globalIndex = currentPage * itemsPerPage + index + 1;
                row.innerHTML = `
                    <td>${globalIndex}</td>
                    <td>${jury.id}</td>
                    <td>${jury.address}</td>
                    <td>${jury.height}</td>
                    <td>${reasonText}</td>
                    <td>${verdictText}</td>
                `;
                juryListElement.appendChild(row);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏, –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–µ–Ω—å—à–µ itemsPerPage
            const remainingRows = itemsPerPage - juryList.items.length;
            for (let i = 0; i < remainingRows; i++) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                `;
                juryListElement.appendChild(emptyRow);
            }

            updatePagination();
        }

        function updatePagination() {
            const paginationElement = document.getElementById('pagination');
            paginationElement.innerHTML = '';

            const totalPages = Math.ceil(juryList.total / itemsPerPage);
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏—Ñ—Ä –≤ –æ–±—â–µ–º —á–∏—Å–ª–µ —Å—Ç—Ä–∞–Ω–∏—Ü
            const totalDigits = totalPages.toString().length;
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –≤–µ–¥—É—â–∏–º–∏ –Ω—É–ª—è–º–∏
            const formattedCurrentPage = (currentPage + 1).toString().padStart(totalDigits, '0');

            // –ö–Ω–æ–ø–∫–∞ –≤ –Ω–∞—á–∞–ª–æ "<<"
            const firstPageButton = document.createElement('button');
            firstPageButton.textContent = '<<';
            firstPageButton.disabled = currentPage === 0;
            firstPageButton.onclick = () => {
                currentPage = 0;
                fetchJury();
            };
            paginationElement.appendChild(firstPageButton);

            // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ "<"
            const prevPageButton = document.createElement('button');
            prevPageButton.textContent = '<';
            prevPageButton.disabled = currentPage === 0;
            prevPageButton.onclick = () => {
                currentPage = Math.max(0, currentPage - 1);
                fetchJury();
            };
            paginationElement.appendChild(prevPageButton);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–∑ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            const pageInfo = document.createElement('span');
            pageInfo.textContent = ` ${formattedCurrentPage} –∏–∑ ${totalPages} `;
            pageInfo.style.margin = '0 10px';
            paginationElement.appendChild(pageInfo);

            // –ö–Ω–æ–ø–∫–∞ –≤–ø–µ—Ä–µ–¥ ">"
            const nextPageButton = document.createElement('button');
            nextPageButton.textContent = '>';
            nextPageButton.disabled = currentPage >= totalPages - 1;
            nextPageButton.onclick = () => {
                currentPage = Math.min(totalPages - 1, currentPage + 1);
                fetchJury();
            };
            paginationElement.appendChild(nextPageButton);

            // –ö–Ω–æ–ø–∫–∞ –≤ –∫–æ–Ω–µ—Ü ">>"
            const lastPageButton = document.createElement('button');
            lastPageButton.textContent = '>>';
            lastPageButton.disabled = currentPage >= totalPages - 1;
            lastPageButton.onclick = () => {
                currentPage = totalPages - 1;
                fetchJury();
            };
            paginationElement.appendChild(lastPageButton);
        }

        async function fetchJury() {
            try {
                const response = await fetch(`/list_juries`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "page": currentPage,
                        "limit": itemsPerPage,
                    })
                });
                
                juryList = await response.json();
                renderJury();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –∂—é—Ä–∏:', error);
            }
        }

        function window_onload() {
            fetchJury();
            setInterval(fetchJury, 30000);
        };
    </script>

    <script src="/js/main.js"></script>
</body>

</html>